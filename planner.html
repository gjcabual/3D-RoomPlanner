<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>3D Room Planner</title>
    <link rel="stylesheet" href="css/planner.css" />
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <!-- A-Frame Components -->
    <script src="js/components/movement.js"></script>
    <script src="js/components/floor-resize.js"></script>
    <script src="js/components/smart-placement.js"></script>
    <script src="js/components/draggable-furniture.js"></script>
    <script src="js/components/clickable-furniture.js"></script>
    <script src="js/components/position-debug.js"></script>
    <script src="js/utils/debug.js"></script>
    <!-- Main Application Script -->
    <script src="js/planner.js"></script>
  </head>
  <body>
    <!-- Back Button -->
    <button id="back-button" onclick="goBack()">â† Back to Setup</button>

    <!-- Side Panel Toggle Button -->
    <button id="panel-toggle" onclick="togglePanel()">ğŸ“¦</button>

    <!-- Cost Estimator Panel (hidden; replaced by in-scene board) -->
    <div id="cost-panel" style="display: none"></div>

    <!-- Side Panel with 3D Models -->
    <div id="side-panel">
      <div class="panel-header">
        <h3>ğŸ¯ Furniture Library</h3>
        <small>Drag & drop furniture into your room</small>
      </div>

      <div class="model-category">
        <div class="category-title">ğŸ½ï¸ Tables</div>
        <div class="model-grid">
          <div
            class="model-item enabled"
            draggable="true"
            data-model="table1"
            data-scale="1 1 1"
          >
            <span class="model-icon">
              <!-- Inline SVG: simple table icon -->
              <svg
                width="28"
                height="22"
                viewBox="0 0 28 22"
                xmlns="http://www.w3.org/2000/svg"
              >
                <rect x="2" y="2" width="24" height="4" rx="1" fill="#6b7280" />
                <rect x="3" y="6" width="2" height="14" rx="1" fill="#6b7280" />
                <rect
                  x="23"
                  y="6"
                  width="2"
                  height="14"
                  rx="1"
                  fill="#6b7280"
                />
                <rect x="8" y="6" width="2" height="10" rx="1" fill="#6b7280" />
                <rect
                  x="18"
                  y="6"
                  width="2"
                  height="10"
                  rx="1"
                  fill="#6b7280"
                />
              </svg>
            </span>
            <div class="model-name">Center Table</div>
          </div>
          <div class="model-item disabled" data-model="coffee-table">
            <div class="disabled-overlay">SOON</div>
            <span class="model-icon">â˜•</span>
            <div class="model-name">Coffee Table</div>
          </div>
          <div class="model-item disabled" data-model="desk">
            <div class="disabled-overlay">SOON</div>
            <span class="model-icon">ğŸ’»</span>
            <div class="model-name">Desk</div>
          </div>
          <div class="model-item disabled" data-model="side-table">
            <div class="disabled-overlay">SOON</div>
            <span class="model-icon">ğŸª‘</span>
            <div class="model-name">Side Table</div>
          </div>
        </div>
      </div>

      <div class="model-category">
        <div class="category-title">ğŸª‘ Seating</div>
        <div class="model-grid">
          <div class="model-item disabled" data-model="chair">
            <div class="disabled-overlay">SOON</div>
            <span class="model-icon">ğŸª‘</span>
            <div class="model-name">Chair</div>
          </div>
          <div class="model-item disabled" data-model="sofa">
            <div class="disabled-overlay">SOON</div>
            <span class="model-icon">ğŸ›‹ï¸</span>
            <div class="model-name">Sofa</div>
          </div>
          <div class="model-item disabled" data-model="armchair">
            <div class="disabled-overlay">SOON</div>
            <span class="model-icon">ğŸ›‹ï¸</span>
            <div class="model-name">Armchair</div>
          </div>
          <div class="model-item disabled" data-model="stool">
            <div class="disabled-overlay">SOON</div>
            <span class="model-icon">ğŸª‘</span>
            <div class="model-name">Stool</div>
          </div>
        </div>
      </div>

      <div class="model-category">
        <div class="category-title">ğŸ›ï¸ Bedroom</div>
        <div class="model-grid">
          <div class="model-item disabled" data-model="bed">
            <div class="disabled-overlay">SOON</div>
            <span class="model-icon">ğŸ›ï¸</span>
            <div class="model-name">Bed</div>
          </div>
          <div
            class="model-item enabled"
            draggable="false"
            data-category="wardrobe"
            onclick="showWardrobeSubcategory()"
          >
            <span class="model-icon">ğŸ‘”</span>
            <div class="model-name">Wardrobe</div>
          </div>
          <div class="model-item disabled" data-model="dresser">
            <div class="disabled-overlay">SOON</div>
            <span class="model-icon">ğŸª</span>
            <div class="model-name">Dresser</div>
          </div>
          <div class="model-item disabled" data-model="nightstand">
            <div class="disabled-overlay">SOON</div>
            <span class="model-icon">ğŸ’¡</span>
            <div class="model-name">Nightstand</div>
          </div>
        </div>
      </div>

      <!-- Wardrobe Subcategory (hidden by default) -->
      <div
        class="model-category"
        id="wardrobe-subcategory"
        style="display: none"
      >
        <div class="category-title">ğŸ‘” Wardrobe Options</div>
        <div class="model-grid">
          <div
            class="model-item enabled"
            draggable="true"
            data-model="wardrobe1"
            data-scale="1 1 1"
          >
            <span class="model-icon">ğŸ‘”</span>
            <div class="model-name">Wardrobe 1</div>
          </div>
          <div
            class="model-item enabled"
            draggable="true"
            data-model="wardrobe2"
            data-scale="1 1 1"
          >
            <span class="model-icon">ğŸ‘”</span>
            <div class="model-name">Wardrobe 2</div>
          </div>
          <div
            class="model-item enabled"
            draggable="true"
            data-model="wardrobe3"
            data-scale="1 1 1"
          >
            <span class="model-icon">ğŸ‘”</span>
            <div class="model-name">Wardrobe 3</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Instructions -->
    <div id="instructions">
      <button id="instructions-toggle" onclick="toggleInstructions()">?</button>
      <div class="instructions-content">
        <p><strong>ğŸ® Controls:</strong></p>
        <p>W/A/S/D â†’ Move around</p>
        <p>Q â†’ Move Up | E â†’ Move Down</p>
        <p>Mouse â†’ Look around</p>
        <hr style="margin: 10px 0; border-color: #666" />
        <p><strong>ğŸ½ï¸ Furniture:</strong></p>
        <p>ğŸ“¦ Click panel button to open library</p>
        <p>ğŸ–±ï¸ Drag the center table into your room</p>
        <p>ğŸ–±ï¸ Click an item to show more options</p>
        <hr style="margin: 10px 0; border-color: #666" />
        <p><strong>ğŸ“Š Cost Board:</strong></p>
        <p>ğŸ“‹ Simple white panel - positioned at right wall</p>
        <p>ğŸ’° Shows costs and total</p>
        <p>ğŸ‘€ Walk around to view from different angles</p>
        <p
          id="room-info"
          style="
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #666;
          "
        ></p>
      </div>
    </div>

    <!-- Drop Indicator -->
    <div class="drop-indicator" id="drop-indicator">ğŸ“ Drop Item Here</div>

    <!-- Cost Estimation Panel (Toggleable) -->
    <div id="cost-estimation-panel" class="collapsed">
      <button id="cost-toggle" onclick="toggleCostPanel()">ğŸ’°</button>
      <div class="cost-panel-content">
        <h3>ğŸ’° Cost Estimation</h3>
        <div id="cost-items-list"></div>
        <div class="cost-total-section">
          <div class="cost-total-row">
            <span>Total:</span>
            <span id="cost-total-display">â‚±0.00</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Furniture Control Panel -->
    <div id="furniture-control-panel">
      <button class="close-controls" onclick="closeControlPanel()">Ã—</button>
      <h3 id="control-panel-title">Furniture Controls</h3>
      <div class="control-buttons">
        <button class="control-btn rotate-left" onclick="rotateFurnitureLeft()">
          â†¶ Rotate Left
        </button>
        <button
          class="control-btn rotate-right"
          onclick="rotateFurnitureRight()"
        >
          â†· Rotate Right
        </button>
        <button class="control-btn delete" onclick="deleteFurniture()">
          ğŸ—‘ï¸ Delete
        </button>
        <button class="control-btn color" disabled>ğŸ¨ Color (Soon)</button>
      </div>
    </div>

    <!-- A-Frame Scene - Full Screen Workspace -->
    <a-scene
      id="scene"
      embedded
      style="height: 100vh; width: 100vw"
      vr-mode-ui="enabled: false"
    >
      <!-- Sky/Background -->
      <a-sky color="#000000"></a-sky>

      <!-- Camera Rig with continuous movement -->
      <a-entity id="cameraRig" position="0 1.6 5" custom-movement>
        <a-camera
          look-controls="pointerLockEnabled: false; enabled: true; magicWindowTrackingEnabled: false"
          wasd-controls="enabled: false"
          cursor="rayOrigin: mouse"
        ></a-camera>
      </a-entity>

      <!-- Enhanced Lighting -->
      <a-light type="ambient" color="#ffffff" intensity="0.6"></a-light>
      <a-light
        type="directional"
        position="10 15 5"
        color="#ffffff"
        intensity="0.8"
        shadow="cast: true"
      ></a-light>
      <a-light
        type="point"
        position="0 5 0"
        color="#ffffff"
        intensity="0.3"
      ></a-light>

      <!-- Floor with non-reflective material -->
      <a-plane
        id="floor"
        rotation="-90 0 0"
        width="10"
        height="10"
        color="#7BC8A4"
        material="roughness: 1; metalness: 0"
        shadow="receive: true"
        floor-resize
      ></a-plane>

      <!-- Room Walls -->
      <a-entity id="room-walls"></a-entity>

      <!-- Furniture Container -->
      <a-entity id="furniture-container"></a-entity>

      <!-- Grid helper for better spatial awareness -->
      <a-entity id="grid-helper" visible="false"></a-entity>

      <!-- In-Scene Cost Board -->
      <a-entity id="cost-board" position="-3 2 -3" rotation="0 45 0">
        <a-plane
          width="2.2"
          height="1.2"
          color="#ffffff"
          material="roughness: 1; metalness: 0"
          opacity="1.0"
          shadow="receive: true"
        ></a-plane>
        <a-text
          value="Cost Estimator"
          color="#333"
          position="-1 0.45 0.01"
          width="3"
        ></a-text>
        <a-entity id="cost-lines" position="-1 0.25 0.01"></a-entity>
        <a-text
          id="cost-total-text"
          value="Total: â‚±0.00"
          color="#333"
          position="-1 -0.45 0.01"
          width="3"
        ></a-text>
      </a-entity>
    </a-scene>
  </body>
</html>
